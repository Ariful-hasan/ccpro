var $gchatBtn,chat_web_key,chat_call_id,ChatJoinRequestTime,cahtIdleTime,agentId="1015",agentNick="Mr. X",obj=null,customerChatBox={},cCustomerName=null,cCustomerEmail=null,cCustomerSubject=null,cCustomerSubjectText=null,cCustomerLanguage=null,requestTimeoutInterval=6,timeout=null,chatIdleInterval=360,idleTimeout=null,textTypingAt=new Date,textTyping=!1,textTypingMineAt=new Date,textTypingMine=!1,conversationClosed=!1,textBoxfocus=!1,socket_ip="",socket_port="",available=0,geoLocation="",natPingInterval=null,natPingResponseCount=0,logId="",checkQueueInterval=null,leave_text_length=300,default_lan="";function GetVisitorInfo(e,t,o,a,r,s,i,c,l){socket_ip=s,socket_port=i,geoLocation=t+"|"+a+"|"+o,c=c,l=l,enableChatButton(e=parseInt(e),c,l)}function UpdateChatLog(e){$.ajax({type:"POST",url:baseUrl+"/chat_agent.php",data:{upd_log:"1",user:user,cid:e,logid:logId},dataType:"jsonp",success:function(e){}})}function jssdk(){$gchatBtn=$(".gcc-chat-button"),$.ajax({type:"POST",url:baseUrl+"/client_info.php",data:{page_id:page_id,site_key:site_key,user:user},dataType:"jsonp",success:function(e){GetVisitorInfo(e.available,e.country,e.region,e.city,e.postal_code,e.ws_ip,e.ws_port,e.language,e.service),$("#chat_preloader").hide()}}),window.onbeforeunload=function(e){var t=$.cookie("cCustomerWebKey");null!=t&&t.lenght>0?ChatClose():null!=obj&&obj.ChatClose(),clearCookie(),$.cookie("customerChatBox","{}")}}function enableChatButton(e,t,o){var a="gCCCustomerChatButton";$("body").append("<div id='"+a+"' class='"+layout+"' data-language='"+t+"' data-service='"+o+"'><span class='gcc-left'>Chat Now</span><span class='gcc-right'>&plus;</span></div>");var r=$("#"+a);$gchatBtn.addClass("gchat-button"),$gchatBtn.removeClass("btn-disable"),availabe=parseInt(e),$gchatBtn.removeClass("btn-disable"),$gchatBtn.click(function(){0==$(".g-chat-customer-window").length?(r.hide(),joinToChat()):(r.hide(),$(".g-chat-customer-window").show())}),r.click(function(){r.hide(),0==$(".g-chat-customer-window").length?joinToChat():$(".g-chat-customer-window").show()}),enableCookie(),$.cookie("available_agent",e),existingChatBoxes(),r.click()}function joinToChat(){if($("#g-chat-customer-window").length<=0){var e=getForm();createCustomerChatWindow("","",$(window).width()-12,$(window).height()-12,e)}}function chat_leave_text_form(){var e=$("#gCCCustomerChatButton").data("language"),t=$("#gCCCustomerChatButton").data("service"),o=(void 0!==e&&e.length>0?e.split("|"):new Array,void 0!==t&&t.length>0?t.split("|"):new Array),a="";if(a+="<form id='leave_text_form' class='cmxform'>",a+="<div class='form-group row'>",a+="<div class='col-xs-12 control-label'>No agent available to chat right now. <br>Please call to customer care or fill-up following form.<br/></div>",a+="</div>",a+="<div id='error_div' class='form-group row hide'>",a+="<div class='col-xs-12 mb-10'>",a+="<div class='alert alert-danger'></div>",a+="</div>",a+="</div>",a+="<div class='form-group form-row row'>",a+="<label class='col-xs-12 control-label' for='cCustomerName'>Name",a+="&nbsp;<span class='chat-form-error'>*</span></label>",a+="<div class='col-xs-12'>",a+="<input id='cCustomerName' name='cCustomerName' placeholder='Name' class='form-control input-md' type='text' value='"+($.cookie("tempCustomerName")?$.cookie("tempCustomerName"):"")+"' ",a+="data-rule-required='true' data-msg-required='Name is required!' data-rule-maxlength='20' data-msg-maxlength='Please enter no more than 20 characters!' ",a+=">",a+="</div>",a+="</div>",a+="<div class='form-group form-row row'>",a+="<label class='col-xs-12 control-label' for='cCustomerEmail'>Email",a+="&nbsp;<span class='chat-form-error'>*</span></label>",a+="<div class='col-xs-12'>",a+="<input id='cCustomerEmail' name='cCustomerEmail' placeholder='Email' class='form-control input-md' type='text' value='"+($.cookie("tempCustomerEmail")?$.cookie("tempCustomerEmail"):"")+"' ",a+="data-rule-required='true' data-msg-required='Email is required!' data-rule-email='true' data-msg-email='Email is not valid!' data-rule-maxlength='35' data-msg-maxlength='Please enter no more than 35 characters!'",a+=">",a+="</div>",a+="</div>",a+="<div class='form-group form-row row'>",a+="<label class='col-xs-12 control-label' for='cCustomerEmail'>Contact Number",a+="&nbsp;<span class='chat-form-error'>*</span></label>",a+="<div class='col-xs-12'>",a+="<input id='cCustomerContactNumber' name='cCustomerContactNumber' placeholder='Contact Number' class='form-control input-md' type='text' value='"+($.cookie("tempCustomerContactNumber")?$.cookie("tempCustomerContactNumber"):"")+"' ",a+="data-rule-required='true' data-msg-required='Contact Number is required!' data-rule-maxlength='11' data-msg-maxlength='Please enter no more than 11 characters!' ",a+=">",a+="</div>",a+="</div>",o.length>0){for(a+="<div class='form-group form-row row'>",a+="<label class='col-xs-12 control-label' for='cCustomerSubject'>Service",a+="&nbsp;<span class='chat-form-error'>*</span></label>",a+="<div class='col-xs-12'>",a+="<select id='cCustomerSubject' name='cCustomerSubject' class='form-control' data-rule-required='true' data-msg-required='Service is required!' data-rule-maxlength='2' data-msg-maxlength='Please enter no more than 2 characters!'>\t\t\t\t\t<option value=''>---Select---</option>",i=0;i<o.length;i++){a+="<option value='"+(r=o[i].split("="))[0]+"'>"+r[1]+"</option>"}a+="</select>",a+="</div>",a+="</div>"}else{for(a+="<div class='form-group form-row row' style='display:none;'>",a+="<label class='col-xs-12 control-label' for='cCustomerSubject'>Service",a+="&nbsp;<span class='chat-form-error'>*</span></label>",a+="<div class='col-xs-12'>",a+="<select id='cCustomerSubject' name='cCustomerSubject' class='form-control' data-rule-required='true' data-msg-required='Service is required!' data-rule-maxlength='2' data-msg-maxlength='Please enter no more than 2 characters!'>\t\t\t\t\t<option value=''>---Select---</oloadption>",i=0;i<o.length;i++){var r;a+="<option value='"+(r=o[i].split("="))[0]+"'>"+r[1]+"</option>"}a+="</select>",a+="</div>",a+="</div>"}return a+="<div class='form-group form-row row'>",a+="<label class='col-xs-12 control-label' for='leave_text_field'>Message",a+="&nbsp;<span class='chat-form-error'>*</span></label>",a+="<div class='col-xs-12 mb-10'>",a+="<textarea id='leave_text_field' name='leave_text_field' placeholder='Please leave your text here' class='form-control leave-text-area' rows='4' maxlength='"+leave_text_length+"' ",a+="data-rule-required='true' data-msg-required='This field is required!' data-rule-maxlength='"+leave_text_length+"' data-msg-maxlength='Please enter no more than "+leave_text_length+" characters!'",a+="></textarea>",a+="<small id='leave_text_field_help_block' class='form-text text-muted'>Characters left: "+leave_text_length+"</small>",a+="</div>",a+="</div>",a+="<div class='form-group form-row row'>",a+="<div class='col-xs-12'>",a+="<button id='leave_text_btn' name='leave_text_btn' class='btn btn-warning'>Submit</button>",a+="</div>",a+="</div>",a+="</form>"}function chat_login_form(){var e=$("#gCCCustomerChatButton").data("language"),t=$("#gCCCustomerChatButton").data("service"),o=void 0!==e&&e.length>0?e.split("|"):new Array,a=void 0!==t&&t.length>0?t.split("|"):new Array,r="";if(r+="<form id='chat_login_form' class='cmxform'>",r+="<div class='form-group row'>",r+="<div class='col-xs-12 control-label'>Welcome to our LiveChat! Please fill in the form below to chat</div>",r+="</div>",r+="<div id='error_div' class='form-group row hide'>",r+="<div class='col-xs-12 mb-10'>",r+="<div class='alert alert-danger'></div>",r+="</div>",r+="</div>",r+="<div class='form-group form-row row'>",r+="<label class='col-xs-12 control-label' for='cCustomerName'>Name",r+="&nbsp;<span class='chat-form-error'>*</span></label>",r+="<div class='col-xs-12'>",r+="<input id='cCustomerName' name='cCustomerName' placeholder='Name' class='form-control input-md' type='text' value='"+($.cookie("tempCustomerName")?$.cookie("tempCustomerName"):"")+"' ",r+="data-rule-required='true' data-msg-required='Name is required!' data-rule-maxlength='20' data-msg-maxlength='Please enter no more than 20 characters!' ",r+=">",r+="</div>",r+="</div>",r+="<div class='form-group form-row row'>",r+="<label class='col-xs-12 control-label' for='cCustomerEmail'>Email",r+="&nbsp;<span class='chat-form-error'>*</span></label>",r+="<div class='col-xs-12'>",r+="<input id='cCustomerEmail' name='cCustomerEmail' placeholder='Email' class='form-control input-md' type='text' value='"+($.cookie("tempCustomerEmail")?$.cookie("tempCustomerEmail"):"")+"' ",r+="data-rule-required='true' data-msg-required='Email is required!' data-rule-email='true' data-msg-email='Email is not valid!' data-rule-maxlength='35' data-msg-maxlength='Please enter no more than 35 characters!'",r+=">",r+="</div>",r+="</div>",r+="<div class='form-group form-row row'>",r+="<label class='col-xs-12 control-label' for='cCustomerEmail'>Contact Number",r+="&nbsp;<span class='chat-form-error'>*</span></label>",r+="<div class='col-xs-12'>",r+="<input id='cCustomerContactNumber' name='cCustomerContactNumber' placeholder='Contact Number' class='form-control input-md' type='text' value='"+($.cookie("tempCustomerContactNumber")?$.cookie("tempCustomerContactNumber"):"")+"' ",r+="data-rule-required='true' data-msg-required='Contact Number is required!' data-rule-required='true' data-msg-required='Email is required!' data-rule-maxlength='11' data-msg-maxlength='Please enter no more than 11 characters!' ",r+=">",r+="</div>",r+="</div>",a.length>0){for(r+="<div class='form-group form-row row'>",r+="<label class='col-xs-12 control-label' for='cCustomerSubject'>Service",r+="&nbsp;<span class='chat-form-error'>*</span></label>",r+="<div class='col-xs-12'>",r+="<select id='cCustomerSubject' name='cCustomerSubject' class='form-control' data-rule-required='true' data-msg-required='Service is required!' data-rule-maxlength='2' data-msg-maxlength='Please enter no more than 2 characters!'>\t\t\t\t\t<option value=''>---Select---</option>",i=0;i<a.length;i++){r+="<option value='"+(s=a[i].split("="))[0]+"'>"+s[1]+"</option>"}r+="</select>",r+="</div>",r+="</div>"}else{for(r+="<div class='form-group form-row row' style='display:none;'>",r+="<label class='col-xs-12 control-label' for='cCustomerSubject'>Service",r+="&nbsp;<span class='chat-form-error'>*</span></label>",r+="<div class='col-xs-12'>",r+="<select id='cCustomerSubject' name='cCustomerSubject' class='form-control' data-rule-required='true' data-msg-required='Service is required!' data-rule-maxlength='2' data-msg-maxlength='Please enter no more than 2 characters!'>\t\t\t\t\t<option value=''>---Select---</option>",i=0;i<a.length;i++){r+="<option value='"+(s=a[i].split("="))[0]+"'>"+s[1]+"</option>"}r+="</select>",r+="</div>",r+="</div>"}if(o.length>1){for(r+="<div class='form-group form-row row'>",r+="<label class='col-xs-12 control-label' for='cCustomerLanguage'>Language",r+="&nbsp;<span class='chat-form-error'>*</span></label>",r+="<div class='col-xs-12'>",r+="<select id='cCustomerLanguage' name='cCustomerLanguage' class='form-control'>\t\t\t\t<option value=''>---Select---</option>",i=0;i<o.length;i++){r+="<option value='"+(s=o[i].split("="))[0]+"'>"+s[1]+"</option>"}r+="</select>",r+="</div>",r+="</div>"}else{for(r+="<div class='form-group form-row row' style='display:none;'>",r+="<label class='col-xs-12 control-label' for='cCustomerLanguage'>Language",r+="&nbsp;<span class='chat-form-error'>*</span></label>",r+="<div class='col-xs-12'>",r+="<select id='cCustomerLanguage' name='cCustomerLanguage' class='form-control'>",i=0;i<o.length;i++){var s;r+="<option value='"+(s=o[i].split("="))[0]+"'>"+s[1]+"</option>"}r+="</select>",r+="</div>",r+="</div>"}return r+="<div id='verify_user' class='form-group form-row row'>",r+="<label class='col-xs-12 control-label'>I am verify user",r+="&nbsp;<span class='chat-form-error'>*</span></label>",r+="<div class='checkbox-inline'>",r+="<input id='verify_user_yes' name='verify_user' type='radio' class='login-verify-user' value='Y' required='true' />",r+="<label class='mr-10' for='verify_user_yes'>Yes</label>",r+="<input id='verify_user_no' name='verify_user' type='radio' class='login-verify-user' value='N' />",r+="<label class='mr-10' for='verify_user_no'>No</label>",r+="</div>",r+="</div>",r+="<div class='form-group form-row row'>",r+="<label class='col-xs-12 control-label' for='cCustomerInfoSend'></label>",r+="<div class='col-xs-12'>",r+="<button id='cCustomerInfoSend' name='cCustomerInfoSend' class='btn btn-warning'>OK</button>",r+="</div>",r+="</div>",r+="</form>"}function getForm(){$.cookie("cCustomerWebKey");var e=$("#gCCCustomerChatButton").data("language"),t=$("#gCCCustomerChatButton").data("service");void 0!==e&&e.length>0?e.split("|"):new Array,void 0!==t&&t.length>0?t.split("|"):new Array,$.cookie("tempCustomerName")&&$.cookie("tempCustomerName"),$.cookie("tempCustomerEmail")&&$.cookie("tempCustomerEmail"),$.cookie("tempCustomerContactNumber")&&$.cookie("tempCustomerContactNumber");return 0==$.cookie("available_agent")?chat_leave_text_form():chat_login_form()}function closeChatSession(){$("#btnChatClose").click(function(){bootbox.confirm({message:"Do you want to close this conversation?",buttons:{confirm:{label:"Yes",className:"btn-success"},cancel:{label:"No",className:"btn-danger"}},callback:function(e){if(e){var t=$.cookie("cCustomerWebKey");console.log(t),console.log(obj),console.log($.cookie("cCustomerCallId")),null!=obj?obj.ChatClose():ChatClose(),$gchatBtn.show(),$.cookie("customerChatBox","{}");var o=$.cookie("cCustomerCallId");null!=o&&"null"!=o&&0!=o.length?(clearCookie(),showRatingView(o)):(clearCookie(),window.opener.document.location.href=return_url,window.close())}}})})}function returnChatSession(){$("#btnChatReturn").click(function(){var e=$.cookie("cCustomerCallId"),t=$.cookie("cCustomerWebKey");null!=e&&"null"!=e&&0!=e.length||null!=t&&t.lenght>0||null!=obj?bootbox.confirm({message:"Do you want to close this conversation and got to Home page?",buttons:{confirm:{label:"Yes",className:"btn-success"},cancel:{label:"No",className:"btn-danger"}},callback:function(o){o&&(null!=t&&t.lenght>0?ChatClose():null!=obj&&obj.ChatClose(),$gchatBtn.show(),$.cookie("customerChatBox","{}"),null!=e&&"null"!=e&&0!=e.length?(clearCookie(),showRatingView(e)):clearCookie(),window.opener.document.location.href=return_url,window.close())}}):(clearCookie(),window.opener.document.location.href=return_url,window.close())})}function setLanguageText(){document.getElementById("language_en").checked?($.fn.bnKb.lang_change("e"),default_lan="e"):document.getElementById("language_bn").checked&&($.fn.bnKb.lang_change("b"),default_lan="b")}function setDefaultLanguage(){""==default_lan&&($("#chatTextInputBox").bnKb({switchkey:{webkit:"k",mozilla:"y",safari:"k",chrome:"k",msie:"y"},driver:phonetic,writingMode:"b"}),default_lan="b")}function submitLeaveText(){$("#leave_text_field").keyup(function(){leave_text_length-$(this).val().length>=0&&$("#leave_text_field_help_block").html("Characters left: "+(leave_text_length-$(this).val().length))}),$("#leave_text_form").validate(),$("#leave_text_form").on("submit",function(e){$("#error_div").addClass("hide"),$("#error_div").find("div.alert-danger").html("");var t=$("#cCustomerName").val(),o=$("#cCustomerEmail").val(),a=$("#cCustomerContactNumber").val(),r=$("#cCustomerSubject").val(),s=$("#leave_text_field").val();$("#leave_text_form").valid()&&(e.preventDefault(),$("#leave_text_form").addClass("hide"),$("#leave_text_form").after(loading_html()),$.ajax({type:"post",url:baseUrl+"/save_chat_msg.php",data:{cCustomerName:t,cCustomerEmail:o,cCustomerContactNumber:a,leave_text_field:s,cCustomerSubject:r,page_id:page_id,site_key:site_key,user:user},dataType:"text",contentType:"application/x-www-form-urlencoded",success:function(e){$("#chat_body_preloader").remove();var t=JSON.parse(e);1==t.result?$(".gccw-body").html('<div class="col-xs-12 control-label">'+t.message+"</div>"):(void 0!==t.data&&t.data.length>0&&$.each(t.data,function(e,t){$.each(t.msg,function(e,o){$("#"+t.field).addClass("error"),$("#"+t.field).parent("div").find("label#"+t.field+"-error").remove(),$("#"+t.field).after('<label id="'+t.field+'-error" class="error" for="'+t.field+'">'+o+"</label>")})}),$("#error_div").removeClass("hide"),$("#error_div").find("div.alert-danger").html(t.message),$("#leave_text_form").removeClass("hide"))}}))})}function chat_opt_form(){var e="";return e+="<form id='chat_opt_form' class='cmxform'>",e+="<input type='hidden' id='auth_code' name='auth_code' value=''>",e+="<div class='form-group row'>",e+="<div class='col-xs-12 control-label'>Please submit your One Time Password (OTP)</div>",e+="</div>",e+="<div id='error_div' class='form-group row hide'>",e+="<div class='col-xs-12 mb-10'>",e+="<div class='alert alert-danger'></div>",e+="</div>",e+="</div>",e+="<div class='form-group form-row row'>",e+="<div class='col-xs-12'>",e+="<input id='opt_number' name='opt_number' class='form-control input-md' type='password' ",e+="data-rule-required='true' data-msg-required='This field is required!' ",e+=">",e+="</div>",e+="</div>",e+="</div>",e+="</div>",e+="<div class='form-group form-row row'>",e+="<div class='col-xs-4'>&nbsp;</div>",e+="<div class='col-xs-8'>",e+="<button id='opt_ok' name='opt_ok' class='btn btn-warning'>OK</button>",e+="</div>",e+="</div>",e+="</form>"}function chat_opt_submit_form(){var e=chat_opt_form();$("#g-chat-customer-window .gccw-body").html(e),$("#chat_opt_form").validate(),$("#chat_opt_form").bind("submit").on("submit",function(e){$("#error_div").addClass("hide"),$("#error_div").find("div.alert-danger").html(""),$("#chat_opt_form").valid()&&(e.preventDefault(),$("#chat_opt_form").addClass("hide"),$("#chat_opt_form").after(loading_html()),$.ajax({type:"post",url:baseUrl+"/checked_otp_code.php",data:{code:$("#opt_number").val(),auth_code:$("#auth_code").val(),page_id:page_id,site_key:site_key,user:user},dataType:"text",contentType:"application/x-www-form-urlencoded",success:function(e){$("#chat_body_preloader").remove();var t=JSON.parse(e);if(1==t.result)if($("#chat_body_preloader").remove(),$("#chat_opt_form").remove(),null!=obj)ChatJoin();else try{(obj=new gPlexCCChatWSApi).loadSettings("wss://"+srv_name+":"+socket_port+"/chat?token="+srv_token),obj.Connect()}catch(e){alert(e.message)}else $("#error_div").removeClass("hide"),$("#error_div").find("div.alert-danger").html(t.message),$("#chat_opt_form").removeClass("hide")}}))})}function chat_sent_type_form(){var e="";return e+="<form id='chat_sent_type_form' class='cmxform'>",e+="<input type='hidden' id='auth_code' name='auth_code' value=''>",e+="<div class='form-group row'>",e+="<div class='col-xs-12 control-label'>Please select your preferred channel to receive your One Time Password (OTP) for completing your authentication.</div>",e+="</div>",e+="<div id='error_div' class='form-group row hide'>",e+="<div class='col-xs-12 mb-10'>",e+="<div class='alert alert-danger'></div>",e+="</div>",e+="</div>",e+="<div class='form-group form-row row'>",e+="<div class='col-xs-2'>&nbsp;</div>",e+="<div class='col-xs-10'>",e+="<label class='radio-container'>"+$.cookie("cCustomerEmail"),e+="<input name='otp_sent_type' type='radio' class='radio-sent-type' value='EM' data-rule-required='true' data-msg-required='Please select one option!' />",e+="<span class='checkmark'></span>",e+="</label>",e+="<label class='radio-container'>"+$.cookie("cCustomerContactNumber"),e+="<input name='otp_sent_type' type='radio' class='radio-sent-type' value='MO' />",e+="<span class='checkmark'></span>",e+="</label>",e+="</div>",e+="</div>",e+="<div class='form-group form-row row'>",e+="<div class='col-xs-4'>&nbsp;</div>",e+="<div class='col-xs-8'>",e+="<button id='sent_type_ok' name='sent_type_ok' class='btn btn-warning'>OK</button>",e+="</div>",e+="</div>",e+="</form>"}function chat_sent_type_selection(){var e=chat_sent_type_form();$("#g-chat-customer-window .gccw-body").html(e),$("#chat_sent_type_form").validate(),$("#chat_sent_type_form").bind("submit").on("submit",function(e){$("#error_div").addClass("hide"),$("#error_div").find("div.alert-danger").html(""),otp_sent_type=$(".radio-sent-type:checked").val(),$.cookie("cCustomerOtpSentType",otp_sent_type),$("#chat_sent_type_form").valid()&&(e.preventDefault(),$("#chat_sent_type_form").addClass("hide"),$("#chat_sent_type_form").after(loading_html()),$.ajax({type:"post",url:baseUrl+"/send_chat_code.php",data:{otp_sent_type:otp_sent_type,auth_code:$("#auth_code").val(),page_id:page_id,site_key:site_key,user:user},dataType:"text",contentType:"application/x-www-form-urlencoded",success:function(e){$("#chat_body_preloader").remove();var t=JSON.parse(e);1==t.result?($("#chat_body_preloader").remove(),$("#chat_sent_type_form").remove(),chat_opt_submit_form(),$("#auth_code").val(t.data.auth_code)):($("#error_div").removeClass("hide"),$("#error_div").find("div.alert-danger").html(t.message),$("#chat_sent_type_form").removeClass("hide"))}}))})}function greetingsText(){var e=JSON.parse(greetings_start_time),t=JSON.parse(greetings_end_time),o=JSON.parse(greetings_message),a="";return $.each(e,function(e,r){var s=new Date,i=r.split(":"),c=t[e].split(":"),l=new Date(s.getFullYear(),s.getMonth(),s.getDate(),parseInt(i[0]),parseInt(i[1])),n=new Date(s.getFullYear(),s.getMonth(),s.getDate(),parseInt(c[0]),parseInt(c[1]));if(l<=s&&n>=s)return a=o[e],!1}),a}function createCustomerChatWindow(e,t,o,a,r){var s=layout,i=$.cookie("available_agent"),c="<div id='g-chat-customer-window' class='container-fluid g-chat-customer-window gccw-"+s+"'>";if(c+="<div class='row gccw-header'>",c+="",c+="<div class='col-xs-7'>",c+="<img class='img-thumbnail chat-logo' alt='logo' src='https://www.robi.com.bd/system/cms/themes/robi/img/logo_head_main.png'>",c+="<label class='welcome-text'>Welcome to Live Chat</label>",c+="<label class='greetings-text'>"+greetingsText()+"</label>",c+="</div>",c+="<div class='col-xs-5'>",c+="<a class='btn btn-primary btn-xs pull-right' id='btnChatClose'>Close</a>",c+="<a class='btn btn-return btn-xs pull-right mr-10' id='btnChatReturn'>Return</a>",c+="</div>",c+="</div>",c+="<div class='gccw-body'>",c+=r.length>0?r:"",c+="</div>",c+="<div class='gccw-footer'>",c+="<div class='checkbox-inline language-check'>",c+="<input id='language_en' name='language_rd' type='radio' class='radio-language' value='EN' onclick='setLanguageText()' />",c+="<label class='mr-10' for='language_en'>English</label>",c+="<input id='language_bn' name='language_rd' type='radio' class='radio-language' value='BN' checked='checked' onclick='setLanguageText()' />",c+="<label for='language_bn'>Bangla</label>",c+="</div>",c+="<div><textarea id='chatTextInputBox' class='bangla' onfocus='setDefaultLanguage()'></textarea></div>",c+="<input id='btnSend' type='button' class='btn btn-default btn-send' value='Send'></div>",c+="</div>",c+="</div>",$("body").append(c),autosize(document.querySelectorAll("textarea")),$(".gccw-footer").hide(),closeChatSession(),returnChatSession(),0!=i){var l=$.cookie("tempCustomerSubject")?$.cookie("tempCustomerSubject"):"",n=$.cookie("tempCustomerLanguage")?$.cookie("tempCustomerLanguage"):"";$("#cCustomerSubject").val(l),$("#cCustomerLanguage").val(n);var u=$(".g-chat-customer-window");u.css({}),customerChatBox={left:e,top:t,width:o,height:a},$.cookie("customerChatBox",JSON.stringify(customerChatBox)),$(".g-chat-customer-window").click(function(){textBoxfocus=!1,u.find(".gccw-header").removeClass("highlight")}),$(".g-chat-customer-window .gccw-footer textarea").keypress(function(e){if(conversationClosed)return!1;textBoxfocus=!1,u.find(".gccw-header").removeClass("highlight");var t=e.keyCode?e.which:e.keyCode;if(textTypingMine)return 13==t?(KeyPressTrigger(),!1):void 0;new Date;textTypingMine=!0;var o=$("#gccw-typing");sendChunkText(u.find(".gccw-body"),o,".")}),$("#btnSend").click(function(){KeyPressTrigger()}),$("#gcc-action-minimize").click(function(){$(".g-chat-customer-window").hide(),$("#gCCCustomerChatButton").show()}),$(".login-verify-user").on("click",function(){$(this).is(":checked")&&$("#verify_user-error").remove()}),$("#chat_login_form").validate(),$("#chat_login_form").bind("submit").on("submit",function(e){$("#error_div").addClass("hide"),$("#error_div").find("div.alert-danger").html(""),cCustomerName=$("#cCustomerName").val(),cCustomerEmail=$("#cCustomerEmail").val(),cCustomerContact=$("#cCustomerContactNumber").val(),cCustomerSubject=$("#cCustomerSubject").val(),cCustomerSubjectText=$("#cCustomerSubject option:selected").text(),cCustomerLanguage=$("#cCustomerLanguage").val(),cCustomerLanguageText=$("#cCustomerLanguage option:selected").text(),cCustomerVerify=$("input[name='verify_user']:checked").val(),$.cookie("tempCustomerName",cCustomerName),$.cookie("tempCustomerEmail",cCustomerEmail),$.cookie("tempCustomerContactNumber",cCustomerContact),$.cookie("tempCustomerSubject",cCustomerSubject),$.cookie("tempCustomerLanguage",cCustomerLanguage),$.cookie("tempcCustomerVerify",cCustomerVerify);var t=$("#chat_login_form").valid(),o=!0;if(cCustomerVerify||($("#chat_login_form").find("#verify_user .checkbox-inline").append('<label id="verify_user-error" class="error" for="verify_user">This field is required!</label>'),o=!1),!t||!o)return!1;if(e.preventDefault(),$("#chat_login_form").addClass("hide"),$("#chat_login_form").after(loading_html()),$("#g-chat-customer-window .gccw-header .gccw-name").html("&nbsp;Connecting..."),$.cookie("cCustomerName",cCustomerName),$.cookie("cCustomerEmail",cCustomerEmail),$.cookie("cCustomerContactNumber",cCustomerContact),$.cookie("cCustomerSubject",cCustomerSubject),$.cookie("cCustomerSubjectText",cCustomerSubjectText),$.cookie("cCustomerLanguage","EN"),$.cookie("cCustomerLanguageText",cCustomerLanguageText),$.cookie("cCustomerVerify",cCustomerVerify),console.log(cCustomerVerify),console.log($.cookie("cCustomerVerify")),"Y"==cCustomerVerify)$.ajax({type:"post",url:baseUrl+"/send_chat_code.php",data:{otp_sent_type:"MO",cCustomerName:cCustomerName,cCustomerEmail:cCustomerEmail,cCustomerContactNumber:cCustomerContact,cCustomerSubject:cCustomerSubject,cCustomerVerify:cCustomerVerify,page_id:page_id,site_key:site_key,user:user},dataType:"text",contentType:"application/x-www-form-urlencoded",success:function(e){$("#chat_body_preloader").remove();var t=JSON.parse(e);1==t.result?($("#chat_body_preloader").remove(),$("#chat_login_form").remove(),chat_opt_submit_form(),$("#auth_code").val(t.data.auth_code)):($("#error_div").removeClass("hide"),$("#error_div").find("div.alert-danger").html(t.message),$("#chat_login_form").removeClass("hide"))}});else if($("#chat_body_preloader").remove(),$("#chat_login_form").remove(),console.log(obj),null!=obj)ChatJoin();else try{(obj=new gPlexCCChatWSApi).loadSettings("wss://"+srv_name+":"+socket_port+"/chat?token="+srv_token),obj.Connect()}catch(e){alert(e.message)}})}else submitLeaveText()}function loading_html(){var e="";return e+='<div id="chat_body_preloader" class="chat-preloader text-center">',e+="<label><small>Please wait...<small></label>",e+='<img class="img-fluid" src="'+assetUrl+'images/5_34.gif" alt="preloader">',e+="</div>"}function KeyPressTrigger(){var e=$("#chatTextInputBox"),t=e.val();if(0==(t=nl2br(t=$.trim(t))).length)return!1;e.css("height","47px"),e.val("").focus(),sendChunkText($(".g-chat-customer-window").find(".gccw-body"),$("#gccw-typing"),t)}function sendChunkText(e,t,o){var a=msgRow({from:$.cookie("cCustomerName"),name:$.cookie("cCustomerName"),msg:o,receiverId:agentId,receiverName:agentNick},"L");"."!=o&&(t.length<=0?e.append(a):t.before(a)),e.scrollTop(e[0].scrollHeight);var r=(o=b64e(o)).match(/.{1,250}/g),s=r.length-1,c=Math.floor(Date.now()/1e3);for(i=0;i<=s;i++)console.log("Sending text: "+c+"|"+r[i]+"|"+s+"|"+i),ChatText(b64e(c+"|"+r[i]+"|"+s+"|"+i))}function nl2br(e,t){return(e+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1"+(t||void 0===t?"<br />":"<br>")+"$2")}function ChatJoin(){try{ChatJoinRequestTime=new Date,checkSession(),$.ajax({type:"POST",url:baseUrl+"/chat_agent.php",data:{page_id:page_id,site_key:site_key,user:user,service:$.cookie("cCustomerSubject"),name:$.cookie("cCustomerName"),email:$.cookie("cCustomerEmail"),contact:$.cookie("cCustomerContactNumber"),subject:$.cookie("cCustomerSubjectText"),service_id:$.cookie("cCustomerSubject"),language:$.cookie("cCustomerLanguage"),domain:domain,www_ip:www_ip,url:web_site_url,duration:user_arival_duration,location:geoLocation},dataType:"jsonp",success:function(e){if(console.log("resp.available"),e.available=parseInt(e.available),e.available>0)conversationClosed=!1,logId=e.logid,obj.ChatJoin({name:$.cookie("cCustomerName"),email:$.cookie("cCustomerEmail"),contact:$.cookie("cCustomerContactNumber"),subject:$.cookie("cCustomerSubjectText"),service_id:$.cookie("cCustomerSubject"),language:$.cookie("cCustomerLanguage"),domain:domain,page_id:page_id,site_key:site_key,www_ip:www_ip,url:web_site_url,duration:user_arival_duration,location:geoLocation});else{$.cookie("available_agent",0);var t=getForm();$("#g-chat-customer-window .gccw-body").html(t)}}})}catch(e){alert("Excpetion: "+e.message)}}function checkSession(){if(get_time_diff(ChatJoinRequestTime,new Date)>requestTimeoutInterval)return obj.Close(),void clearTimeout(timeout);timeout=setTimeout(checkSession,1e3)}function checkIdleTime(){if(get_time_diff(cahtIdleTime,new Date)>chatIdleInterval)return obj.ChatClose(),void clearTimeout(idleTimeout);timeout=setTimeout(checkIdleTime,1e3)}function get_time_diff(e,t){return(t.getTime()-e.getTime())/1e3}function ChatText(e){try{obj.ChatText(e)}catch(e){alert("Exception: "+e.message)}}function ChatClose(){try{conversationClosedNotification(),obj.ChatClose()}catch(e){alert("Exception: "+e.message)}}function clearCookie(){$.cookie("cCustomerWebKey",null),$.cookie("cCustomerCallId",null),$.cookie("cCustomerName",null),$.cookie("cCustomerEmail",null),$.cookie("cCustomerSubject",null),$.cookie("cCustomerLanguage",null),$.cookie("cCustomerVerify",null)}function welcomeMessageToCustomer(e,t){isChatInIdle=!0,cahtIdleTime=new Date;var o=$(".g-chat-customer-window");$("#g-chat-customer-window .gccw-header .gccw-name").html(e),console.log(t),t?(clearInterval(checkQueueInterval),$.ajax({type:"post",url:baseUrl+"/update_chat_queue.php",data:{cCustomerCallId:$.cookie("cCustomerCallId"),page_id:page_id,site_key:site_key,user:user},dataType:"text",contentType:"application/x-www-form-urlencoded",success:function(e){var t=JSON.parse(e);console.log(t)}}),$(".gccw-footer").show(),setTimeout(function(){var e=msgRow({from:agentId,name:agentNick,msg:"আমার নাম "+$.cookie("cChatAgentName"),receiverId:$.cookie("cCustomerName"),receiverName:$.cookie("cCustomerName")},"R"),t=o.find(".gccw-body");t.html(e),t.scrollTop(t[0].scrollHeight)},1500),setTimeout(function(){var e=msgRow({from:agentId,name:agentNick,msg:"আমি কিভাবে আপনাকে সাহায্য করতে পারি?",receiverId:$.cookie("cCustomerName"),receiverName:$.cookie("cCustomerName")},"R"),t=o.find(".gccw-body");t.append(e),t.scrollTop(t[0].scrollHeight)},3e3)):$.ajax({type:"post",url:baseUrl+"/insert_chat_queue.php",data:{cCustomerCallId:$.cookie("cCustomerCallId"),cCustomerName:$.cookie("cCustomerName"),cCustomerEmail:$.cookie("cCustomerEmail"),cCustomerContactNumber:$.cookie("cCustomerContactNumber"),cCustomerSubject:$.cookie("cCustomerSubject"),cCustomerVerify:$.cookie("cCustomerVerify"),page_id:page_id,site_key:site_key,user:user},dataType:"text",contentType:"application/x-www-form-urlencoded",success:function(e){var t=JSON.parse(e),a=o.find(".gccw-body"),r="<br/><div class='col-md-12'>You are in queue. Your queue number is "+t.queue_number+", please wait a while... </div>";r+='<div id="queue_body_preloader" class="chat-preloader text-center">',r+="<label><small>Please wait...<small></label>",r+='<img class="img-fluid" src="'+assetUrl+'images/30_gray.gif" alt="preloader">',r+="</div>",a.html(r),checkQueueInterval=setInterval(checkQueue,1e4)}})}setTimeout(jssdk,2e3);var textReceivedArray=new Array,currentMsgTimestamp=0;function msgReceived(e){var t=b64d(e.message).split("|");currentMsgTimestamp!=t[0]&&(textReceivedArray=new Array),currentMsgTimestamp=t[0];var o=parseInt(t[3]);textReceivedArray[o]=t[1];var a=textReceivedArray.length-1;parseInt(t[2])==parseInt(t[3])&&a==parseInt(t[3])&&msgShowInWindow(e,b64d(textReceivedArray.join("")))}function msgShowInWindow(e,t){var o=e.web_key;if("."==t){textTypingAt=new Date,$.cookie("textTypingAt",textTypingAt),chatWriting();var a=$("#g-chat-customer-window");return $boxBody=a.find(".gccw-body"),void $boxBody.scrollTop($boxBody[0].scrollHeight)}textBoxfocus=!0,$("#g-chat-customer-window").length<=0&&createCustomerChatWindow("","",300,378,""),$("#g-chat-customer-window textarea").is(":focus")||$("#chatAudio")[0].play();var r=msgRow({from:o,name:"Agent",msg:t},"R");$("#gccw-typing").remove();a=$("#g-chat-customer-window");$boxBody=a.find(".gccw-body"),$boxBody.append(r),$boxBody.scrollTop($boxBody[0].scrollHeight),textReceivedArray=new Array}function msgRow(e,t){cahtIdleTime=new Date;var o=new Date,a=parseInt(o.getHours()),r=a>12?"pm":"am",s=("0"+(a>12?a-12:a)).slice(-2)+":"+("0"+o.getMinutes()).slice(-2)+":"+("0"+o.getSeconds()).slice(-2)+" "+r;return"L"==t?"<div class='msg-row'>\t\t\t\t<div class='caption-left'>"+e.name+" --- <span class='timestmp'>"+s+"</span></div>\t\t\t\t<span class='msg-item left'>"+urlify(e.msg)+"</span>\t\t\t\t<div class='clear'></div>\t\t\t</div>":"<div class='msg-row'>\t\t\t\t<div class='caption-right'><span class='timestmp'>"+s+"</span> --- "+$.cookie("cChatAgentName")+"</div>\t\t\t\t<span class='msg-item right'>"+urlify(e.msg)+"</span>\t\t\t\t<div class='clear'></div>\t\t\t</div>"}function loadjscssfile(e,t){if("js"==t)(o=document.createElement("script")).setAttribute("type","text/javascript"),o.setAttribute("src",e);else if("css"==t){var o;(o=document.createElement("link")).setAttribute("rel","stylesheet"),o.setAttribute("type","text/css"),o.setAttribute("href",e)}void 0!==o&&document.getElementsByTagName("head")[0].appendChild(o)}function handleDragStop(e,t){$("#g-chat-customer-window");var o=parseInt(t.offset.left),a=parseInt(t.offset.top);customerChatBox.left=o,customerChatBox.top=a,$.cookie("customerChatBox",JSON.stringify(customerChatBox))}function handleResizeStop(e,t){$("#g-chat-customer-window");customerChatBox.width=parseInt(t.size.width),customerChatBox.height=parseInt(t.size.height),$.cookie("customerChatBox",JSON.stringify(customerChatBox))}function existingChatBoxes(){if(null!=(customerChatBox=JSON.parse($.cookie("customerChatBox")))&&parseInt(customerChatBox.width)>0){var e=getForm();createCustomerChatWindow(customerChatBox.left,customerChatBox.top,customerChatBox.width,customerChatBox.height,e)}countUpTextTypingTime()}function isValidEmailAddress(e){return/^([a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+(\.[a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)*|"((([ \t]*\r\n)?[ \t]+)?([\x01-\x08\x0b\x0c\x0e-\x1f\x7f\x21\x23-\x5b\x5d-\x7e\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|\\[\x01-\x09\x0b\x0c\x0d-\x7f\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))*(([ \t]*\r\n)?[ \t]+)?")@(([a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.)+([a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.?$/i.test(e)}function chatWriting(){if($typingIndicator=$("#gccw-typing"),$typingIndicator.length<=0){var e=$("#g-chat-customer-window .gccw-body");row="<div class='msg-row'>\t\t\t\t<div class='caption-right'><span class='timestmp'> &nbsp; </div>\t\t\t\t<span class='msg-item right'><img src='ccd/typing.gif' height='8' style='margin:3px;'></span>\t\t\t\t<div class='clear'></div>\t\t\t</div>",e.append("<div id='gccw-typing'>"+row+"</div>")}}function conversationClosedNotification(){if(conversationClosed=!0,$indicator=$("#gccw-closed-conversation"),$indicator.length<=0){var e=$("#g-chat-customer-window .gccw-body");e.append("<div id='gccw-closed-conversation'>Conversation closed by Agent</div>"),e.scrollTop(e[0].scrollHeight)}}function countUpTextTypingTime(){var e=new Date,t=$(".g-chat-customer-window"),o=new Date($.cookie("textTypingAt"));if(null!=o){seconds=get_time_diff(o,e);var a=$("#gccw-typing");seconds>7&&a.length>0&&(a.remove(),o=new Date,textTyping=!1,$.cookie("textTypingAt",o))}null!=textTypingMineAt&&(seconds=get_time_diff(textTypingMineAt,e),seconds>5&&(textTypingMineAt=new Date,textTypingMine=!1)),textBoxfocus&&t.find(".gccw-header").toggleClass("highlight"),setTimeout("countUpTextTypingTime()",1e3)}function NatPing(){console.log("Pinging...");var e=b64e(JSON.stringify({isTyping:!0}));obj.Reg(e),natPingInterval=setTimeout(NatPing,2e4)}function checkQueue(){console.log("Queue..."),$.ajax({type:"post",url:baseUrl+"/check_chat_queue.php",data:{cCustomerCallId:$.cookie("cCustomerCallId"),page_id:page_id,site_key:site_key,user:user},dataType:"text",contentType:"application/x-www-form-urlencoded",success:function(e){var t=JSON.parse(e),o=$("#g-chat-customer-window").find(".gccw-body"),a="<br/><div class='col-md-12'>You are in queue. Your queue number is "+t.queue_number+", please wait a while... </div>";a+='<div id="queue_body_preloader" class="chat-preloader text-center">',a+="<label><small>Please wait...<small></label>",a+='<img class="img-fluid" src="'+assetUrl+'images/30_gray.gif" alt="preloader">',a+="</div>",o.html(a)}})}function enableCookie(){jQuery.cookie=function(e,t,o){if(void 0===t){var a=null;if(document.cookie&&""!=document.cookie)for(var r=document.cookie.split(";"),s=0;s<r.length;s++){var i=jQuery.trim(r[s]);if(i.substring(0,e.length+1)==e+"="){a=decodeURIComponent(i.substring(e.length+1));break}}return a}o=o||{},null===t&&(t="",o.expires=-1);var c,l="";o.expires&&("number"==typeof o.expires||o.expires.toUTCString)&&("number"==typeof o.expires?(c=new Date).setTime(c.getTime()+24*o.expires*60*60*1e3):c=o.expires,l="; expires="+c.toUTCString());var n=o.path?"; path="+o.path:"",u=o.domain?"; domain="+o.domain:"",d=o.secure?"; secure":"";document.cookie=[e,"=",encodeURIComponent(t),l,n,u,d].join("")}}function htmlEntities(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function urlify(e){return e.replace(/(https?:\/\/[^\s]+)/g,function(e){return'<a href="'+e+'" target="_blank">'+e+"</a>"})}function showRatingView(e){var t="";t+="<div id='g-chat-customer-window' class='container-fluid g-chat-customer-window gccw-"+layout+"'>",t+="<div class='row gccw-header'>",t+="<div class='col-xs-7'>",t+="<img class='img-thumbnail chat-logo' alt='logo' src='https://www.robi.com.bd/system/cms/themes/robi/img/logo_head_main.png'>",t+="<label class='welcome-text'>Welcome to Live Chat</label>",t+="<label class='greetings-text'>Greeting Text</label>",t+="</div>",t+="<div class='col-xs-5'>",t+="<a class='btn btn-return btn-xs pull-right mr-10' id='btnChatReturn' onclick='returnChatSession()'>Return</a>",t+="</div>",t+="</div>",t+="<div class='gccw-body'>",t+="<div class='row' align='center'>",t+="<div class='col-md-12' id='rateYo_caption'>How do you rate our service?</div>",t+="<div class='col-md-12 center'><div id='rateYo'></div></div>",t+="<div id='rating' class='col-md-12' style='height:36px; font-weight:bold; color:#bbbbbb; margin-top: 5px;'>&nbsp;</div>",t+="<div id='rateYo_button' style='padding-top:30px; padding-bottom:30px;'><a class='btn btn-warning' onclick='window.close()'>Not Now</a></div>",t+="</div>",t+="</div>",t+="</div>",$("body").html(t);setTimeout(function(){$("#rateYo").rateYo({rating:0,fullStar:!0,multiColor:!0,onSet:function(t,o){$("#rateYo_caption").html("Thank you for rating."),$("#rateYo").html(""),$("#rateYo_button").html(""),$("#rating").html("&nbsp;"),CloseChatWindow(t,e)}}).on("rateyo.change",function(e,t){var o=t.rating;o=1==o?"Very Bad":2==o?"Bad":3==o?"Normal":4==o?"Good":5==o?"Very Good":"",$("#rating").text(o)})},200)}function CloseChatWindow(e,t){$.ajax({type:"GET",url:baseUrl+"/chat.php",data:{chat_rating:e,call_id:t,user:user},dataType:"jsonp",success:function(e){}}),setTimeout("window.close()",3e3)}function b64e(e){return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode("0x"+t)}))}function b64d(e){return decodeURIComponent(Array.prototype.map.call(atob(e),function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""))}